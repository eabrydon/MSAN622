<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Information Visualization</title>
    <script src="../../d3/d3.min.js" charset="utf-8"></script>
    <link href="../../css/bootstrap.min.css" rel="stylesheet">
    <link href="../../css/bootstrap-theme.min.css" rel="stylesheet">
	<link rel="stylesheet" href="style.css">
    <script src="../../js/topojson.v1.min.js"></script>
    <script src="script.js"></script>
</head>
<style type="text/css">
    body {
      font: 12px sans-serif;
    }
    .axis path,
    .axis line {
      fill: none;
      stroke: #000000;
      shape-rendering: crispEdges;
    }
	#map {
		display: block;
	}
	.ts {
		background-color: white;
	}
	.area {
	  fill: #8A0707;
	  clip-path: url(#clip);
	}
    .brush .extent {
      stroke: #fff;
      fill-opacity: .125;
      shape-rendering: crispEdges;
    }
</style>
<body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://eabrydon.github.io/MSAN622">MSAN 622</a>
            </div>

            <div id="navbar" class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <li><a href="http://eabrydon.github.io/MSAN622/#homework">Homework</a></li>
                    <li><a href="http://eabrydon.github.io/MSAN622/#project">Project</a></li>
                    <li><a href="http://eabrydon.github.io/MSAN622/#participation">Participation</a></li>
                </ul>

                <ul class="nav navbar-nav navbar-right">
                    <li><a href="http://eabrydon.github.io/MSAN622/#about">About</a></li>
                    <li><a href="http://eabrydon.github.io/MSAN622/#contact">Contact</a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div>
    </nav>
    <div class="jumbotron">
        <div class="container">
            <h1>Final Project</h1>
            <p>World Map with Terror Attacks</p>
        </div>
    </div>
    <div id="block">
	    <h4 align="center">Monthly Deaths From Terrorism</h4>
	    <h6 align="center">Select a time period on the smaller plot below to see a specific time period</h6>
		<svg id="chart2" class="ts" width="10" height="10"></svg>
		<h6 align="center">Major terror attacks from the selected time period are displayed on the world map</h6>
		<svg id="casualties" class="ts" width="10" height="10"></svg>
		<svg id="map" align="center" width="960" height="475"></svg>
		<p id="log" align="center">Loading map... please wait.</p>
        <svg id="bar" align="center" width="10" height="10"></svg>
        <div id = 'explanation', style='margin-top:50;margin-left:50px;margin-right:50px;'>
            <H4>Discussion</H4>
            <br>
            <H5>Techniques</H5>
            <p>The first technique is a time series area plot with the ability to select a time period to zoom in on. The second technique is a map using topoJSON. The size of the dots is proportional to the number of people killed in the attack.</p>
            <H5>Interactivity</H5>
            <p>The first chart allow the user to select a time period in the smaller bottom plot and the to plot will display only the selected time period. The default is to show the entire time period, and to reset the plot the user can simply click outside the selected area in the small chart. The second chart has a tooltip that allows the user to hover over a dot that represents an attack and see information about the attack. The displayed information is the city and country the attack took place in, the type of attack, the number of people killed and wounded in the attack, and the date it occured. The smaller dots are displayed after the larger dots, so the user can scroll over just about every dot to get more information about the attack.</p>
            <H5>Feedback</H5>
            <p>I'm not entirely sure what feedback should be going here so I'll just spew some random thoughts about this assignment and the class in general. I think this class was extremely ambitious in it's goals, considering most of the students - myself included - had little to no javascript or html experience. To try to learn how html, javascript, and D3 work in a seven week course was not really a realistic goal in my opinion, and now at the conclusion of the course I still don't feel that I have come close to mastering the material. As a result of not having time to learn enough javascript or d3, I feel like I don't understand what my code is doing all the time. This made making custom visualizations excrutiatingly difficult. Basically what I'm saying is this class made my life hell this module more than any other class has in any module. </p>
            <p>In terms of this final project, I thought it was a good project that gave us freedom to create interesting visualizations about whatever dataset we wanted. This assignment was definitely a learning experience. However, I'm not sure I learned anything about information visualization outside of D3 from this project, which seems odd for a final in a class called information visualization. </p>
            <H5>Challenges</H5>
            <p>The main challenge I had in this project was gettting the brushed data from the first plot to be the only data shown in the second plot. This involved adapting code from a completely unrelated force layout plot. This challenge ate up a ton of time and energy because the example I was working from was different in so many ways; the data is in a different format and not being read from an external file, the plot is different, the intended animation is completely different, and the animation in the exampleis using a package to draw the plot so the code is much simpler. <br>Other than that, I had originally intended to make a couple time series plots using one selector bar, but couldn't get it to work the way I wanted. As a result, I had to change my planned layout at the last minute. While this wasn't ideal, in the end it was fine. </p>
            <H5>Conclusion</H5>
            <p>In closing, I'm not a big fan of d3 and one of my main takeaways from this course is that Tableau is awesome. Personally, I love to be able to create a good visualization quickly, and I don't have quite enough passion for visualization to take a week to make an excellent d3 visual. I guess my work over the course of this module reflects that. The most disappointing part of this class for me is that I'm not really proud of any of my visualizations. I obviously have no one to blame for this but myself, but it still leaves me feeling dissatisfied. Maybe this is a lesson about data science in general - or even life in general -  and I should just learn to be happy with what I've done, even if it isn't perfect.</p>
        </div>
	</div>
	<script type="text/javascript">

        var parseDate2 = d3.time.format("%m-%d-%Y").parse;

        function size_sort(a,b) {
            return Math.max(b.nkill, b.nwound) - Math.max(a.nkill,a.nwound)};

        var chart = symbolMap();

            // Update how we access data (need the mag property)
        chart = chart.value(function(d) { return Math.max(d.nkill,d.nwound); });

            // Nested calls to trigger drawing in proper order

        d3.json("../Dataset/world-50m.json", function(mapError, mapJSON) {
            if (processError(mapError)) return;

    		var w = window.innerWidth;
    		var margin = {top: 10, right: 10, bottom: 100, left: 50},
    		    margin2 = {top: 280, right: 10, bottom: 20, left: 50},
    		    width = 960 - margin.left - margin.right,
    		    height = 350 - margin.top - margin.bottom,
    		    height2 = 350 - margin2.top - margin2.bottom;

    		var parseDate = d3.time.format("%Y-%m-%d %H:%M:%S").parse;

    		var x = d3.time.scale().range([0, width]),
    		    x2 = d3.time.scale().range([0, width]),
    		    // x3 = d3.time.scale().range([0, width]),
    		    y = d3.scale.linear().range([height, 0]),
    		    y2 = d3.scale.linear().range([height2, 0]);
    		    // y3 = d3.scale.linear().range([height2, 0]);

    		var xAxis = d3.svg.axis().scale(x).orient("bottom"),
    		    xAxis2 = d3.svg.axis().scale(x2).orient("bottom"),
    		    yAxis = d3.svg.axis().scale(y).orient("left");

    		var brush = d3.svg.brush()
    		    .x(x2)
    		    .on("brush", brushed);

    		var area = d3.svg.area()
    		    .interpolate("monotone")
    		    .x(function(d) { return x(parseDate(d.month)); })
    		    .y0(height)
    		    .y1(function(d) { return y(d.killed); });

    		var area2 = d3.svg.area()
    		    .interpolate("monotone")
    		    .x(function(d) { return x2(parseDate(d.month)); })
    		    .y0(height2)
    		    .y1(function(d) { return y2(d.killed); });

    		var svg = d3.select("#chart2")
    		    .attr("width", width + margin.left + margin.right)
    		    .attr("height", height + margin.top + margin.bottom);

    		svg.append("defs").append("clipPath")
    		    .attr("id", "clip")
    		  .append("rect")
    		    .attr("width", width)
    		    .attr("height", height);

    		var focus = svg.append("g")
    		    .attr("class", "focus")
    		    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    		var context = svg.append("g")
    		    .attr("class", "context")
    		    .attr("transform", "translate(" + margin2.left + "," + margin2.top + ")");

    		d3.csv("../Dataset/data2.csv", function(error, data) {
    		  x.domain(d3.extent(data.map(function(d) { return parseDate(d.month); })));
    		  y.domain([0, 2100]);
    		  x2.domain(x.domain());
    		  y2.domain(y.domain());

    		  focus.append("path")
    		      .datum(data)
    		      .attr("class", "area")
    		      .attr("d", area);

    		  focus.append("g")
    		      .attr("class", "x axis")
    		      .attr("transform", "translate(0," + height + ")")
    		      .call(xAxis);

    		  focus.append("g")
    		      .attr("class", "y axis")
    		      .call(yAxis);

    		  context.append("path")
    		      .datum(data)
    		      .attr("class", "area")
    		      .attr("d", area2);

    		  context.append("g")
    		      .attr("class", "x axis")
    		      .attr("transform", "translate(0," + height2 + ")")
    		      .call(xAxis2);

    		  context.append("g")
    		      .attr("class", "x brush")
    		      .call(brush)
    		    .selectAll("rect")
    		      .attr("y", -6)
    		      .attr("height", height2 + 7);
    		});

            function includedData(data, brush) {
                return data.filter(function (d, i, a) {
                    return parseDate2(d.Date) >= brush.extent()[0] && parseDate2(d.Date) <= brush.extent()[1]
                })

            }

            function brushed() {
                x.domain(brush.empty() ? x2.domain() : brush.extent());
                focus.select(".area").attr("d", area);
                focus.select(".x.axis").call(xAxis);


                        // update map data
                d3.select("#map")
                    .selectAll("*")
                    .remove()

                chart = chart.map(mapJSON);

                d3.csv("../Dataset/data.csv", function(dataError, dataJSON) {
                    if (processError(dataError)) return;
                    chart = chart.values(includedData(dataJSON, brush));
                    //chart = chart.values(dataJSON);

                    chart("map");
                });
            }

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////



            // Wait until the map is drawn before loading
            // and drawing the data values
            // d3.csv("../Dataset/data.csv", function(dataError, dataJSON) {
            //     if (processError(dataError)) return;
            //     console.log("DataJSON")
            //     console.log(dataJSON)
            //     // less_dataJSON = function(d) {
            //     // 	if parseDate2(d.Date) >= x.domain()[0] && parseDate2(d.Date) <= x.domain()[1] {

            //     // }
            //     // }
            //     // chart = chart.values(includedData(dataJSON, brush));
            //     chart = chart.values(dataJSON);

            //     // console.log(includedData(dataJSON, brush))
            //     chart("map");
            // });
        });


</script>